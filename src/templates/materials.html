{% extends "base.html" %}

{% block title %}材料マスタ - 材料管理システム{% endblock %}

{% block extra_head %}
<style>
  :root {
    --primary-navy: #1e3a8a;
    --primary-blue: #3b82f6;
    --success-green: #10b981;
    --warning-amber: #f59e0b;
    --danger-red: #ef4444;
    --neutral-50: #f9fafb;
    --neutral-100: #f3f4f6;
    --neutral-200: #e5e7eb;
    --neutral-600: #4b5563;
    --neutral-700: #374151;
    --neutral-800: #1f2937;
  }

  /* テーブルホバーエフェクト */
  .table-row-hover:hover {
    background: var(--neutral-50);
  }

  /* 検索フォーム強化 */
  .search-container {
    position: relative;
  }

  .search-icon {
    position: absolute;
    left: 16px;
    top: 50%;
    transform: translateY(-50%);
    color: #9ca3af;
    pointer-events: none;
  }

  .search-input {
    padding-left: 48px;
  }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-neutral-50">
  <div class="max-w-[1600px] mx-auto py-4 px-4 sm:px-6 lg:px-8">
    <!-- ページヘッダー -->
    <div class="mb-4">
      <div class="flex items-center justify-between">
        <div class="space-y-1">
          <h1 class="text-2xl font-bold text-neutral-800">
            材料マスタ
          </h1>
          <p class="text-sm text-neutral-600">材料マスタの登録・編集・管理を行います</p>
        </div>
        <div class="flex space-x-4">
          <button
            id="addMaterialBtn"
            class="bg-primary-blue text-white px-6 py-2 rounded-lg font-semibold hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-primary-blue focus:ring-opacity-20"
          >
            <i class="fas fa-plus mr-2"></i>新規材料登録
          </button>
        </div>
      </div>
    </div>

    <!-- フィルタ・検索バー -->
    <div class="bg-white rounded-lg p-4 mb-4 border border-neutral-200 shadow-sm">
      <div class="flex items-center mb-4">
        <div class="p-3 bg-primary-blue bg-opacity-10 rounded-lg mr-3">
          <i class="fas fa-filter text-xl text-primary-blue"></i>
        </div>
        <h3 class="text-lg font-semibold text-neutral-800">検索・フィルター</h3>
      </div>
      <form id="searchForm" class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div class="search-container">
          <i class="fas fa-search search-icon"></i>
          <input
            type="text"
            name="display_name"
            placeholder="材料仕様で検索..."
            class="search-input w-full p-3 border border-neutral-200 rounded-lg focus:ring-2 focus:ring-primary-blue focus:ring-opacity-20 focus:border-primary-blue bg-white text-neutral-800"
          />
        </div>
        <div>
          <select
            name="shape"
            class="w-full p-3 border border-neutral-200 rounded-lg focus:ring-2 focus:ring-primary-blue focus:ring-opacity-20 focus:border-primary-blue bg-white text-neutral-800"
          >
            <option value="">全ての形状</option>
            <option value="round">丸棒</option>
            <option value="hexagon">六角棒</option>
            <option value="square">角棒</option>
          </select>
        </div>
        <div class="search-container">
          <i class="fas fa-ruler search-icon"></i>
          <input
            type="number"
            name="diameter_mm"
            placeholder="径(mm)で検索..."
            step="0.1"
            min="0"
            class="search-input w-full p-3 border border-neutral-200 rounded-lg focus:ring-2 focus:ring-primary-blue focus:ring-opacity-20 focus:border-primary-blue bg-white text-neutral-800"
          />
        </div>
        <div class="flex items-end">
          <button
            type="reset"
            class="w-full bg-white border border-neutral-200 text-neutral-700 px-4 py-2 rounded-lg font-semibold hover:bg-neutral-50"
          >
            <i class="fas fa-redo mr-2"></i>リセット
          </button>
        </div>
      </form>
    </div>

    <!-- 材料一覧テーブル -->
    <div class="bg-white rounded-lg border border-neutral-200 shadow-sm overflow-hidden">
      <!-- ページネーション (上部) -->
      <div id="materialsPaginationTop" class="px-4 py-3 bg-neutral-50 border-b border-neutral-200"></div>

      <div class="overflow-x-auto">
        <table id="materialsTable" class="min-w-full">
          <thead class="bg-neutral-50">
            <tr>
              <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-700 uppercase tracking-wider">
                <i class="fas fa-tag mr-2 text-primary-blue"></i>材料仕様
              </th>
              <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-700 uppercase tracking-wider">
                <i class="fas fa-shapes mr-2 text-success-green"></i>形状
              </th>
              <th class="px-4 py-3 text-left text-sm font-semibold text-neutral-700 uppercase tracking-wider">
                <i class="fas fa-ruler mr-2 text-warning-amber"></i>径 (mm)
              </th>
              <th class="px-4 py-3 text-right text-sm font-semibold text-neutral-700 uppercase tracking-wider">
                <i class="fas fa-cog mr-2 text-neutral-600"></i>操作
              </th>
            </tr>
          </thead>
          <tbody id="materialsTableBody" class="bg-white divide-y divide-neutral-100">
            <!-- 材料データはJavaScriptで動的生成 -->
          </tbody>
        </table>
      </div>

      <!-- ページネーション (下部) -->
      <div id="materialsPaginationBottom" class="px-4 py-3 bg-neutral-50 border-t border-neutral-200"></div>
    </div>

    <!-- ローディング表示 -->
    <div id="loading" class="hidden text-center py-16">
      <div class="inline-flex flex-col items-center bg-white rounded-lg p-8 border border-neutral-200 shadow-sm">
        <div class="animate-spin rounded-full h-12 w-12 border-4 border-neutral-200 border-t-primary-blue mb-4"></div>
        <span class="text-neutral-700 font-semibold text-base">読み込み中...</span>
        <span class="text-neutral-600 text-sm mt-2">データを取得しています</span>
      </div>
    </div>
  </div>
</div>

<!-- 材料登録/編集モーダル -->
<div
  id="materialModal"
  class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50"
>
  <div class="bg-white rounded-xl max-w-md w-full max-h-[90vh] overflow-y-auto shadow-lg">
      <div class="px-6 py-4 border-b border-neutral-200">
        <h3 id="modalTitle" class="text-xl font-semibold text-neutral-900 flex items-center">
          <div class="p-2 bg-primary-blue bg-opacity-10 rounded-lg mr-3">
            <i class="fas fa-cube text-primary-blue text-lg"></i>
          </div>
          新規材料登録
        </h3>
      </div>

      <form id="createMaterialForm" class="p-6">
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-semibold text-neutral-700 mb-2">
              <i class="fas fa-tag mr-2 text-primary-blue"></i>材料仕様 *
            </label>
            <input
              type="text"
              id="display_name"
              name="display_name"
              required
              class="w-full px-4 py-3 border border-neutral-200 rounded-lg focus:ring-2 focus:ring-primary-blue focus:ring-opacity-20 focus:border-primary-blue bg-white text-neutral-800 placeholder-neutral-500"
              placeholder="例: SUS303 φ10.0 研磨"
            />
          </div>

          <div>
            <label class="block text-sm font-semibold text-neutral-700 mb-2">
              <i class="fas fa-shapes mr-2 text-success-green"></i>形状 *
            </label>
            <select
              id="shape"
              name="shape"
              required
              class="w-full px-4 py-3 border border-neutral-200 rounded-lg focus:ring-2 focus:ring-primary-blue focus:ring-opacity-20 focus:border-primary-blue bg-white text-neutral-800"
            >
              <option value="">選択してください</option>
              <option value="round">丸棒</option>
              <option value="hexagon">六角棒</option>
              <option value="square">角棒</option>
            </select>
          </div>

          <div>
            <label
              id="diameterLabel"
              class="block text-sm font-semibold text-neutral-700 mb-2"
            >
              <i class="fas fa-ruler mr-2 text-warning-amber"></i>径(mm) *
            </label>
            <input
              type="number"
              id="diameter_mm"
              name="diameter_mm"
              required
              step="0.1"
              min="0.1"
              class="w-full px-4 py-3 border border-neutral-200 rounded-lg focus:ring-2 focus:ring-primary-blue focus:ring-opacity-20 focus:border-primary-blue bg-white text-neutral-800 placeholder-neutral-500"
              placeholder="10.0"
            />
          </div>

          <div>
            <label class="block text-sm font-semibold text-neutral-700 mb-2">
              <i class="fas fa-weight mr-2 text-danger-red"></i>比重(g/cm³) *
            </label>
            <div class="space-y-3">
              <select
                id="density_preset_select"
                class="w-full px-4 py-3 border border-neutral-200 rounded-lg focus:ring-2 focus:ring-primary-blue focus:ring-opacity-20 focus:border-primary-blue bg-white text-neutral-800"
              >
                <option value="">プリセットから選択（任意）</option>
              </select>
              <input
                type="number"
                id="current_density"
                name="current_density"
                required
                step="0.01"
                min="0.01"
                class="w-full px-4 py-3 border border-neutral-200 rounded-lg focus:ring-2 focus:ring-primary-blue focus:ring-opacity-20 focus:border-primary-blue bg-white text-neutral-800 placeholder-neutral-500"
                placeholder="7.85"
              />
            </div>
          </div>
        </div>

        <div class="flex justify-end space-x-4 mt-6">
          <button
            type="button"
            data-dismiss="modal"
            class="bg-white border border-neutral-200 text-neutral-700 font-semibold py-2 px-6 rounded-lg hover:bg-neutral-50"
          >
            <i class="fas fa-times mr-2"></i>キャンセル
          </button>
          <button
            type="submit"
            id="submitBtn"
            class="bg-primary-blue text-white font-semibold py-2 px-6 rounded-lg hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-primary-blue focus:ring-opacity-20"
          >
            <i class="fas fa-check mr-2"></i>登録
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- 重量計算モーダル -->
<div
  id="weightCalculatorModal"
  class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50"
>
  <div class="bg-white rounded-xl max-w-md w-full max-h-[90vh] overflow-y-auto shadow-lg">
      <div class="px-6 py-4 border-b border-neutral-200">
        <h3 class="text-xl font-semibold text-neutral-900 flex items-center">
          <div class="p-2 bg-success-green bg-opacity-10 rounded-lg mr-3">
            <i class="fas fa-calculator text-success-green text-lg"></i>
          </div>
          重量計算
        </h3>
        <p class="text-sm text-neutral-600 mt-2 font-medium">
          材料: <span id="calcMaterialName" class="font-semibold text-neutral-900"></span>
        </p>
      </div>

      <div class="p-6">
        <input type="hidden" id="calcMaterialId" />
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-semibold text-neutral-700 mb-2">
              <i class="fas fa-ruler-horizontal mr-2 text-primary-blue"></i>長さ(mm)
            </label>
            <input
              type="number"
              id="calcLength"
              step="1"
              min="1"
              class="w-full px-4 py-3 border border-neutral-200 rounded-lg focus:ring-2 focus:ring-primary-blue focus:ring-opacity-20 focus:border-primary-blue bg-white text-neutral-800 placeholder-neutral-500"
              placeholder="2500"
            />
          </div>

          <div>
            <label class="block text-sm font-semibold text-neutral-700 mb-2">
              <i class="fas fa-sort-numeric-up mr-2 text-success-green"></i>本数
            </label>
            <input
              type="number"
              id="calcQuantity"
              step="1"
              min="1"
              value="1"
              class="w-full px-4 py-3 border border-neutral-200 rounded-lg focus:ring-2 focus:ring-primary-blue focus:ring-opacity-20 focus:border-primary-blue bg-white text-neutral-800 placeholder-neutral-500"
            />
          </div>

          <div id="calcResult" class="bg-neutral-50 rounded-lg p-4 border border-neutral-200">
            <!-- 計算結果はJavaScriptで表示 -->
          </div>
        </div>

        <div class="flex justify-end space-x-4 mt-6">
          <button
            type="button"
            data-dismiss="modal"
            class="bg-white border border-neutral-200 text-neutral-700 font-semibold py-2 px-6 rounded-lg hover:bg-neutral-50"
          >
            <i class="fas fa-times mr-2"></i>閉じる
          </button>
          <button
            type="button"
            id="calculateWeightBtn"
            class="bg-success-green text-white font-semibold py-2 px-6 rounded-lg hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-success-green focus:ring-opacity-20"
          >
            <i class="fas fa-calculator mr-2"></i>計算
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', path='js/pagination.js') }}"></script>
<script src="/static/js/materials.js"></script>
{% endblock %}
