{% extends "base.html" %} {% block title %}材料マスタ - 材料管理システム{%
endblock %} {% block content %}
<div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
  <!-- ページヘッダー -->
      <div class="mb-8">
        <div class="flex items-center justify-between">
          <div>
            <h1 class="text-3xl font-bold text-gray-900">材料マスタ</h1>
            <p class="mt-2 text-gray-600">材料マスタの管理を行います</p>
          </div>
          <div class="flex space-x-3">
            <button
              id="addMaterialBtn"
              class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2.5 px-6 rounded-lg transition-all duration-200 shadow-sm hover:shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1"
            >
              <i class="fas fa-plus mr-2"></i>新規材料登録
            </button>
          </div>
        </div>
      </div>

  <!-- フィルタ・検索バー -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
    <form id="searchForm" class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2"
          >材料名検索</label
        >
        <input
          type="text"
          name="display_name"
          placeholder="材料名で検索..."
          class="w-full px-4 py-2.5 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent hover:border-gray-400"
        />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2"
          >寸法(mm)</label
        >
        <input
          type="number"
          name="diameter_mm"
          placeholder="寸法で検索..."
          step="0.1"
          min="0"
          class="w-full px-4 py-2.5 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent hover:border-gray-400"
        />
      </div>
      <div class="flex items-end">
        <button
          type="reset"
          class="w-full bg-white hover:bg-gray-50 text-gray-700 font-medium py-2.5 px-6 rounded-lg border border-gray-300 transition-all duration-200 shadow-sm hover:shadow-md focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-1"
        >
          リセット
        </button>
      </div>
    </form>
  </div>

  <!-- 材料一覧 -->
  <div
    class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"
  >
    <!-- ページネーション (上部) -->
    <div
      id="paginationTop"
      class="flex items-center justify-between px-4 py-3 bg-white border-b border-gray-200 sm:px-6"
    >
      <div class="flex flex-1 justify-between sm:hidden">
        <button
          id="prevPageMobileTop"
          class="relative inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
          disabled
        >
          前へ
        </button>
        <button
          id="nextPageMobileTop"
          class="ml-3 relative inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          次へ
        </button>
      </div>
      <div class="hidden sm:flex sm:flex-1 sm:items-center sm:justify-between">
        <div>
          <p class="text-sm text-gray-700">
            <span id="pageInfoTop">1 - 100 件を表示中（全 0 件）</span>
          </p>
        </div>
        <div>
          <nav
            class="isolate inline-flex -space-x-px rounded-md shadow-sm"
            aria-label="Pagination"
          >
            <button
              id="prevPageTop"
              class="relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50 disabled:cursor-not-allowed"
              disabled
            >
              <span class="sr-only">前へ</span>
              <svg
                class="h-5 w-5"
                viewBox="0 0 20 20"
                fill="currentColor"
                aria-hidden="true"
              >
                <path
                  fill-rule="evenodd"
                  d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z"
                  clip-rule="evenodd"
                />
              </svg>
            </button>
            <div id="pageNumbersTop" class="flex">
              <!-- ページ番号はJavaScriptで動的生成 -->
            </div>
            <button
              id="nextPageTop"
              class="relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <span class="sr-only">次へ</span>
              <svg
                class="h-5 w-5"
                viewBox="0 0 20 20"
                fill="currentColor"
                aria-hidden="true"
              >
                <path
                  fill-rule="evenodd"
                  d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z"
                  clip-rule="evenodd"
                />
              </svg>
            </button>
          </nav>
        </div>
      </div>
    </div>

    <div class="overflow-x-auto">
      <table id="materialsTable" class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              材料名
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              ユーザー設定名 (name)
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              寸法 (mm)
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              比重 (g/cm³)
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              専用品番・追加情報
            </th>
            <th
              class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              操作
            </th>
          </tr>
        </thead>
        <tbody
          id="materialsTableBody"
          class="bg-white divide-y divide-gray-200"
        >
          <!-- 材料データはJavaScriptで動的生成 -->
        </tbody>
      </table>
    </div>

    <!-- ページネーション (下部) -->
    <div
      id="pagination"
      class="flex items-center justify-between px-4 py-3 bg-white border-t border-gray-200 sm:px-6"
    >
      <div class="flex flex-1 justify-between sm:hidden">
        <button
          id="prevPageMobile"
          class="relative inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
          disabled
        >
          前へ
        </button>
        <button
          id="nextPageMobile"
          class="ml-3 relative inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          次へ
        </button>
      </div>
      <div class="hidden sm:flex sm:flex-1 sm:items-center sm:justify-between">
        <div>
          <p class="text-sm text-gray-700">
            <span id="pageInfo">1 - 100 件を表示中（全 0 件）</span>
          </p>
        </div>
        <div>
          <nav
            class="isolate inline-flex -space-x-px rounded-md shadow-sm"
            aria-label="Pagination"
          >
            <button
              id="prevPage"
              class="relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50 disabled:cursor-not-allowed"
              disabled
            >
              <span class="sr-only">前へ</span>
              <svg
                class="h-5 w-5"
                viewBox="0 0 20 20"
                fill="currentColor"
                aria-hidden="true"
              >
                <path
                  fill-rule="evenodd"
                  d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z"
                  clip-rule="evenodd"
                />
              </svg>
            </button>
            <div id="pageNumbers" class="flex">
              <!-- ページ番号はJavaScriptで動的生成 -->
            </div>
            <button
              id="nextPage"
              class="relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <span class="sr-only">次へ</span>
              <svg
                class="h-5 w-5"
                viewBox="0 0 20 20"
                fill="currentColor"
                aria-hidden="true"
              >
                <path
                  fill-rule="evenodd"
                  d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z"
                  clip-rule="evenodd"
                />
              </svg>
            </button>
          </nav>
        </div>
      </div>
    </div>
  </div>

  <!-- ローディング表示 -->
  <div id="loading" class="hidden text-center py-12">
    <div class="inline-flex items-center">
      <svg
        class="animate-spin -ml-1 mr-3 h-5 w-5 text-blue-600"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
      >
        <circle
          class="opacity-25"
          cx="12"
          cy="12"
          r="10"
          stroke="currentColor"
          stroke-width="4"
        ></circle>
        <path
          class="opacity-75"
          fill="currentColor"
          d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
        ></path>
      </svg>
      <span class="text-gray-600">読み込み中...</span>
    </div>
  </div>
</div>

<!-- 材料登録/編集モーダル -->
<div
  id="materialModal"
  class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50"
>
  <div class="flex items-center justify-center min-h-screen p-4">
    <div
      class="bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto"
    >
      <div class="px-6 py-4 border-b border-gray-200">
        <h3 id="modalTitle" class="text-lg font-semibold text-gray-900">
          新規材料登録
        </h3>
      </div>

      <form id="createMaterialForm" class="p-6">
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >品番</label
            >
            <input
              type="text"
              id="part_number"
              name="part_number"
              class="w-full px-4 py-2.5 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent hover:border-gray-400"
              placeholder="例: P001"
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >材料名 *</label
            >
            <input
              type="text"
              id="name"
              name="name"
              required
              class="w-full px-4 py-2.5 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent hover:border-gray-400"
              placeholder="例: S45C"
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >表示名（表記揺れ対応）</label
            >
            <input
              type="text"
              id="display_name"
              name="display_name"
              class="w-full px-4 py-2.5 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent hover:border-gray-400"
              placeholder="例: SUS303 φ10.0D"
            />
            <p class="text-xs text-gray-500 mt-1">
              φ/∅/D等の表記揺れに対応した表示名
            </p>
          </div>

          <div>
            <!-- 用途区分は廃止（グループ運用へ統一） -->
          </div>

          <div id="dedicatedPartNumberField">
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >専用品番・追加情報</label
            >
            <input
              type="text"
              id="dedicated_part_number"
              name="dedicated_part_number"
              class="w-full px-4 py-2.5 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent hover:border-gray-400"
              placeholder="例: CM, 平目 22山, G 2m"
            />
            <p class="mt-1 text-xs text-gray-500">
              追加情報（例: CM, 平目 22山, G 2m）。必要に応じて専用品番などを記載。
            </p>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >説明</label
            >
            <textarea
              id="description"
              name="description"
              class="w-full px-4 py-2.5 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent hover:border-gray-400"
              placeholder="材料の説明"
            ></textarea>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >形状 *</label
            >
            <select
              id="shape"
              name="shape"
              required
              class="w-full px-4 py-2.5 border border-gray-300 rounded-lg bg-white text-gray-900 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent hover:border-gray-400"
            >
              <option value="">選択してください</option>
              <option value="round">丸棒</option>
              <option value="hexagon">六角棒</option>
              <option value="square">角棒</option>
            </select>
          </div>

          <div>
            <label
              id="diameterLabel"
              class="block text-sm font-medium text-gray-700 mb-2"
              >直径/一辺(mm) *</label
            >
            <input
              type="number"
              id="diameter_mm"
              name="diameter_mm"
              required
              step="0.1"
              min="0.1"
              class="w-full px-4 py-2.5 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent hover:border-gray-400"
              placeholder="20.0"
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >比重(g/cm³) *</label
            >
            <div class="space-y-2">
              <select
                id="density_preset_select"
                class="w-full px-4 py-2.5 border border-gray-300 rounded-lg bg-white text-gray-900 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent hover:border-gray-400"
              >
                <option value="">プリセットから選択（任意）</option>
              </select>
              <input
                type="number"
                id="current_density"
                name="current_density"
                required
                step="0.01"
                min="0.01"
                class="w-full px-4 py-2.5 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent hover:border-gray-400"
                placeholder="7.85"
              />
            </div>
          </div>
        </div>

        <div class="flex justify-end space-x-3 mt-6">
          <button
            type="button"
            data-dismiss="modal"
            class="bg-white hover:bg-gray-50 text-gray-700 font-medium py-2.5 px-6 rounded-lg border border-gray-300 transition-all duration-200 shadow-sm hover:shadow-md focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-1"
          >
            キャンセル
          </button>
          <button
            type="submit"
            id="submitBtn"
            class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2.5 px-6 rounded-lg transition-all duration-200 shadow-sm hover:shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1"
          >
            登録
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- 重量計算モーダル -->
<div
  id="weightCalculatorModal"
  class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50"
>
  <div class="flex items-center justify-center min-h-screen p-4">
    <div
      class="bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto"
    >
      <div class="px-6 py-4 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900">重量計算</h3>
        <p class="text-sm text-gray-600 mt-1">
          材料: <span id="calcMaterialName"></span>
        </p>
      </div>

      <div class="p-6">
        <input type="hidden" id="calcMaterialId" />
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >長さ(mm)</label
            >
            <input
              type="number"
              id="calcLength"
              step="1"
              min="1"
              class="w-full px-4 py-2.5 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent hover:border-gray-400"
              placeholder="2500"
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >本数</label
            >
            <input
              type="number"
              id="calcQuantity"
              step="1"
              min="1"
              value="1"
              class="w-full px-4 py-2.5 border border-gray-300 rounded-lg bg-white text-gray-900 placeholder-gray-500 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent hover:border-gray-400"
            />
          </div>

          <div id="calcResult">
            <!-- 計算結果はJavaScriptで表示 -->
          </div>
        </div>

        <div class="flex justify-end space-x-3 mt-6">
          <button
            type="button"
            data-dismiss="modal"
            class="bg-white hover:bg-gray-50 text-gray-700 font-medium py-2.5 px-6 rounded-lg border border-gray-300 transition-all duration-200 shadow-sm hover:shadow-md focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-1"
          >
            閉じる
          </button>
          <button
            type="button"
            id="calculateWeightBtn"
            class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2.5 px-6 rounded-lg transition-all duration-200 shadow-sm hover:shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1"
          >
            計算
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %} {% block extra_scripts %}
<script src="/static/js/materials.js"></script>
{% endblock %}
