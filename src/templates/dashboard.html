{% extends "base.html" %} {% block title %}ダッシュボード - 材料管理システム{%
endblock %} {% block extra_head %}
<style>
  /* プロフェッショナル配色 */
  :root {
    --primary-navy: #1e3a5f;
    --primary-blue: #2563eb;
    --accent-blue: #3b82f6;
    --success-green: #10b981;
    --warning-amber: #f59e0b;
    --danger-red: #ef4444;
    --neutral-50: #f8fafc;
    --neutral-100: #f1f5f9;
    --neutral-200: #e2e8f0;
    --neutral-700: #334155;
    --neutral-800: #1e293b;
  }

  /* シンプルなKPIカード */
  .kpi-card {
    background: white;
    border: 1px solid var(--neutral-200);
    transition: all 0.2s ease;
  }

  .kpi-card:hover {
    border-color: var(--accent-blue);
    box-shadow: 0 4px 12px rgba(37, 99, 235, 0.08);
  }

  /* データカウンター */
  .counter {
    font-variant-numeric: tabular-nums;
  }

  /* ステータスインジケーター */
  .status-indicator {
    animation: pulse 2s ease-in-out infinite;
  }

  @keyframes pulse {
    0%,
    100% {
      opacity: 1;
    }
    50% {
      opacity: 0.6;
    }
  }

  /* アクションカード - 控えめなホバー */
  .action-card {
    transition: all 0.2s ease;
  }

  .action-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  /* コンパクトなスクロール */
  .compact-section {
    max-height: 320px;
    overflow-y: auto;
  }

  .compact-section::-webkit-scrollbar {
    width: 6px;
  }

  .compact-section::-webkit-scrollbar-track {
    background: var(--neutral-100);
  }

  .compact-section::-webkit-scrollbar-thumb {
    background: var(--neutral-700);
    border-radius: 3px;
  }
</style>
{% endblock %} {% block content %}
<div class="min-h-screen bg-neutral-50">
  <div class="max-w-[1600px] mx-auto py-4 px-4 sm:px-6 lg:px-8">
    <!-- ヘッダーセクション - コンパクト化 -->
    <div class="mb-4">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-2xl font-bold text-neutral-800">ダッシュボード</h1>
          <p class="text-sm text-neutral-600 mt-0.5">生産状況と在庫の全体像</p>
        </div>
        <div class="hidden md:flex items-center space-x-3">
          <div
            class="flex items-center px-3 py-1.5 bg-white border border-neutral-200 rounded-lg"
          >
            <div
              class="status-indicator w-2 h-2 bg-success-green rounded-full mr-2"
            ></div>
            <span
              class="text-xs font-medium text-neutral-700"
              id="refresh-status"
              >システム稼働中</span
            >
          </div>
          <button
            id="refreshDashboard"
            class="p-2 bg-white border border-neutral-200 rounded-lg hover:border-primary-blue hover:bg-neutral-50 transition-all group"
            title="ダッシュボードを再取得"
          >
            <i
              class="fas fa-sync-alt text-neutral-600 text-sm group-hover:text-primary-blue"
            ></i>
          </button>
        </div>
      </div>
    </div>

    <!-- KPIカードセクション - コンパクト化 -->
    <div
      class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 mb-6"
      id="kpiCards"
    >
      <!-- 在庫総数カード -->
      <div class="kpi-card rounded-lg p-4">
        <div class="flex items-start justify-between">
          <div class="flex-1">
            <div
              class="text-xs font-medium text-neutral-600 uppercase tracking-wide mb-1"
            >
              同等品グループ本数
            </div>
            <div
              class="counter text-3xl font-bold text-neutral-800 mb-0.5"
              id="total-inventory"
            >
              -
            </div>
            <div class="text-xs text-neutral-600">
              <span id="group-count">-</span> グループ
            </div>
          </div>
          <div class="p-3 bg-neutral-100 rounded-lg">
            <i class="fas fa-boxes text-2xl text-neutral-500"></i>
          </div>
        </div>
      </div>

      <!-- アクティブ材料カード -->
      <div class="kpi-card rounded-lg p-4">
        <div class="flex items-start justify-between">
          <div class="flex-1">
            <div
              class="text-xs font-medium text-neutral-600 uppercase tracking-wide mb-1"
            >
              アクティブ材料件数
            </div>
            <div
              class="counter text-3xl font-bold text-neutral-800 mb-0.5"
              id="material-types"
            >
              -
            </div>
            <div class="text-xs text-neutral-600" id="last-inventory-refresh">
              -
            </div>
          </div>
          <div class="p-3 bg-success-green bg-opacity-10 rounded-lg">
            <i class="fas fa-cubes text-2xl text-success-green"></i>
          </div>
        </div>
      </div>

      <!-- 入庫待ちカード -->
      <div class="kpi-card rounded-lg p-4">
        <div class="flex items-start justify-between">
          <div class="flex-1">
            <div
              class="text-xs font-medium text-neutral-600 uppercase tracking-wide mb-1"
            >
              入庫待ち・検品待ち
            </div>
            <div
              class="counter text-3xl font-bold text-neutral-800 mb-0.5"
              id="pending-po-count"
            >
              -
            </div>
            <div class="text-xs text-neutral-600">
              見込 <span id="pending-po-weight">-</span>
            </div>
          </div>
          <div class="p-3 bg-warning-amber bg-opacity-10 rounded-lg">
            <i class="fas fa-clipboard-list text-2xl text-warning-amber"></i>
          </div>
        </div>
      </div>

      <!-- 在庫切れ予測カード -->
      <div class="kpi-card rounded-lg p-4">
        <div class="flex items-start justify-between">
          <div class="flex-1">
            <div
              class="text-xs font-medium text-neutral-600 uppercase tracking-wide mb-1"
            >
              在庫切れ予測
            </div>
            <div
              class="counter text-3xl font-bold text-neutral-800 mb-0.5"
              id="forecast-risk-count"
            >
              -
            </div>
            <div class="text-xs text-neutral-600" id="nearest-stockout">-</div>
          </div>
          <div class="p-3 bg-danger-red bg-opacity-10 rounded-lg">
            <i class="fas fa-exclamation-triangle text-2xl text-danger-red"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- メインコンテンツグリッド - コンパクト化 -->
    <div class="grid grid-cols-1 xl:grid-cols-3 gap-4 mb-6">
      <!-- クイックアクション -->
      <div class="xl:col-span-2">
        <div class="bg-white rounded-lg border border-neutral-200 p-4">
          <h3
            class="text-base font-bold text-neutral-800 mb-3 flex items-center"
          >
            <i class="fas fa-bolt text-primary-blue mr-2"></i>
            クイックアクション
          </h3>
          <div class="grid grid-cols-2 md:grid-cols-3 gap-3" id="quickActions">
            <a
              href="/inventory"
              class="action-card flex flex-col items-center p-4 bg-neutral-50 hover:bg-neutral-100 border border-neutral-200 rounded-lg text-center"
            >
              <i class="fas fa-boxes text-2xl text-primary-blue mb-2"></i>
              <div class="text-sm font-semibold text-neutral-800">在庫管理</div>
            </a>
            <a
              href="/order-flow"
              class="action-card flex flex-col items-center p-4 bg-neutral-50 hover:bg-neutral-100 border border-neutral-200 rounded-lg text-center"
            >
              <i class="fas fa-stream text-2xl text-primary-blue mb-2"></i>
              <div class="text-sm font-semibold text-neutral-800">
                発注フロー
              </div>
            </a>
            <a
              href="/movements"
              class="action-card flex flex-col items-center p-4 bg-neutral-50 hover:bg-neutral-100 border border-neutral-200 rounded-lg text-center"
            >
              <i
                class="fas fa-exchange-alt text-2xl text-primary-blue mb-2"
              ></i>
              <div class="text-sm font-semibold text-neutral-800">入出庫</div>
            </a>
            <a
              href="/excel-viewer"
              class="action-card flex flex-col items-center p-4 bg-neutral-50 hover:bg-neutral-100 border border-neutral-200 rounded-lg text-center"
            >
              <i class="fas fa-file-excel text-2xl text-primary-blue mb-2"></i>
              <div class="text-sm font-semibold text-neutral-800">
                セット予定
              </div>
            </a>
            <a
              href="/production-schedule"
              class="action-card flex flex-col items-center p-4 bg-neutral-50 hover:bg-neutral-100 border border-neutral-200 rounded-lg text-center"
            >
              <i class="fas fa-chart-line text-2xl text-primary-blue mb-2"></i>
              <div class="text-sm font-semibold text-neutral-800">
                生産中一覧
              </div>
            </a>
            <a
              href="/analytics"
              class="action-card flex flex-col items-center p-4 bg-neutral-50 hover:bg-neutral-100 border border-neutral-200 rounded-lg text-center"
            >
              <i class="fas fa-chart-bar text-2xl text-primary-blue mb-2"></i>
              <div class="text-sm font-semibold text-neutral-800">集計分析</div>
            </a>
          </div>
        </div>
      </div>

      <!-- 在庫アラート -->
      <div class="bg-white rounded-lg border border-neutral-200 p-4">
        <h3 class="text-base font-bold text-neutral-800 mb-3 flex items-center">
          <i class="fas fa-exclamation-triangle text-warning-amber mr-2"></i>
          在庫アラート
        </h3>
        <div id="stock-alerts" class="compact-section">
          <div class="text-center py-8">
            <div
              class="inline-flex items-center justify-center w-12 h-12 bg-success-green bg-opacity-10 rounded-full mb-3"
            >
              <i class="fas fa-check-circle text-2xl text-success-green"></i>
            </div>
            <p class="text-sm font-medium text-neutral-800">
              現在アラートはありません
            </p>
            <p class="text-xs text-neutral-600 mt-1">在庫状況は正常です</p>
          </div>
        </div>
      </div>
    </div>

    <!-- コンテンツグリッド2段目 -->
    <div class="grid grid-cols-1 xl:grid-cols-2 gap-4">
      <!-- 最近の入出庫 -->
      <div class="bg-white rounded-lg border border-neutral-200 p-4">
        <div class="flex items-center justify-between mb-3">
          <h3 class="text-base font-bold text-neutral-800 flex items-center">
            <i class="fas fa-history text-primary-blue mr-2"></i>
            最近の入出庫
          </h3>
          <a
            href="/movements"
            class="text-xs text-primary-blue hover:underline font-medium"
          >
            入出庫一覧へ →
          </a>
        </div>
        <div id="recent-activities" class="compact-section">
          <div class="text-center py-8">
            <div
              class="inline-flex items-center justify-center w-10 h-10 bg-neutral-100 rounded-full mb-3"
            >
              <i class="fas fa-clock text-xl text-neutral-400"></i>
            </div>
            <p class="text-sm font-medium text-neutral-700">
              活動履歴を取得中...
            </p>
            <p class="text-xs text-neutral-500 mt-1">
              データが読み込まれるまでお待ちください
            </p>
          </div>
        </div>
      </div>

      <!-- 生産・在庫リスク -->
      <div class="bg-white rounded-lg border border-neutral-200 p-4">
        <h3 class="text-base font-bold text-neutral-800 mb-3 flex items-center">
          <i class="fas fa-bolt text-danger-red mr-2"></i>
          生産・在庫リスク
        </h3>
        <div id="stockout-forecast" class="compact-section">
          <div class="text-center py-8">
            <div
              class="inline-block w-8 h-8 border-3 border-neutral-200 border-t-primary-blue rounded-full animate-spin mb-3"
            ></div>
            <p class="text-xs font-medium text-neutral-600">
              在庫切れ予測を集計中...
            </p>
          </div>
        </div>
      </div>

      <!-- 同等品グループ スナップショット -->
      <div class="bg-white rounded-lg border border-neutral-200 p-4">
        <div class="flex items-center justify-between mb-3">
          <h3 class="text-base font-bold text-neutral-800 flex items-center">
            <i class="fas fa-boxes text-neutral-500 mr-2"></i>
            同等品グループ
          </h3>
          <a
            href="/inventory"
            class="text-xs text-primary-blue hover:underline font-medium"
          >
            在庫管理へ →
          </a>
        </div>
        <div class="compact-section" id="groupSnapshot">
          <div class="text-center py-8">
            <div
              class="inline-block w-8 h-8 border-3 border-neutral-200 border-t-primary-blue rounded-full animate-spin mb-3"
            ></div>
            <p class="text-xs font-medium text-neutral-600">
              グループ在庫を読み込んでいます...
            </p>
          </div>
        </div>
      </div>

      <!-- 入庫待ち / 検品待ち -->
      <div class="bg-white rounded-lg border border-neutral-200 p-4">
        <div class="flex items-center justify-between mb-3">
          <h3 class="text-base font-bold text-neutral-800 flex items-center">
            <i class="fas fa-clipboard-check text-warning-amber mr-2"></i>
            入庫待ち / 検品待ち
          </h3>
          <a
            href="/order-flow"
            class="text-xs text-primary-blue hover:underline font-medium"
          >
            発注フローへ →
          </a>
        </div>
        <div class="compact-section" id="pendingPOList">
          <div class="text-center py-8">
            <div
              class="inline-block w-8 h-8 border-3 border-neutral-200 border-t-warning-amber rounded-full animate-spin mb-3"
            ></div>
            <p class="text-xs font-medium text-neutral-600">
              入庫待ち一覧を取得中...
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block extra_scripts %}
<script src="{{ url_for('static', path='/js/dashboard.js') }}"></script>
{% endblock %}
