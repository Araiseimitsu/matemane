{% extends "base.html" %}
{% block title %}リポジトリ情報 - 材料管理システム{% endblock %}
{% block extra_head %}
<style>
  :root {
    --primary-navy: #1e3a5f;
    --primary-blue: #2563eb;
    --accent-blue: #3b82f6;
    --neutral-50: #f8fafc;
    --neutral-100: #f1f5f9;
    --neutral-200: #e2e8f0;
  }

  .info-card {
    background: white;
    border: 1px solid var(--neutral-200);
    transition: all 0.2s ease;
  }

  .info-card:hover {
    border-color: var(--accent-blue);
    box-shadow: 0 4px 12px rgba(37, 99, 235, 0.08);
  }

  .info-label {
    color: #64748b;
    font-weight: 600;
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .info-value {
    color: #1e293b;
    font-size: 1.125rem;
    font-weight: 500;
    word-break: break-all;
  }

  .badge {
    display: inline-flex;
    align-items: center;
    padding: 0.375rem 0.75rem;
    border-radius: 9999px;
    font-size: 0.875rem;
    font-weight: 600;
  }

  .badge-blue {
    background-color: #dbeafe;
    color: #1e40af;
  }

  .badge-green {
    background-color: #d1fae5;
    color: #065f46;
  }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen gradient-bg py-8">
  <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
    
    <!-- ヘッダー -->
    <div class="mb-8 animate-fade-in-up">
      <div class="flex items-center mb-4">
        <i class="fas fa-code-branch text-4xl text-blue-600 mr-4"></i>
        <div>
          <h1 class="text-3xl font-bold text-gray-800">リポジトリ情報</h1>
          <p class="text-gray-600 mt-1">システムとリポジトリの詳細情報</p>
        </div>
      </div>
    </div>

    <!-- ローディング表示 -->
    <div id="loading" class="text-center py-12">
      <i class="fas fa-spinner fa-spin text-4xl text-blue-600 mb-4"></i>
      <p class="text-gray-600">情報を読み込み中...</p>
    </div>

    <!-- 情報表示エリア -->
    <div id="info-container" class="hidden space-y-6 animate-fade-in-up">
      
      <!-- 基本情報 -->
      <div class="info-card rounded-xl p-6">
        <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
          <i class="fas fa-info-circle text-blue-600 mr-3"></i>
          基本情報
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <p class="info-label mb-2">プロジェクト名</p>
            <p class="info-value" id="repo-name">-</p>
          </div>
          <div>
            <p class="info-label mb-2">バージョン</p>
            <p class="info-value">
              <span class="badge badge-blue" id="repo-version">-</span>
            </p>
          </div>
          <div class="md:col-span-2">
            <p class="info-label mb-2">説明</p>
            <p class="info-value text-base" id="repo-description">-</p>
          </div>
        </div>
      </div>

      <!-- Git情報 -->
      <div class="info-card rounded-xl p-6">
        <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
          <i class="fab fa-git-alt text-orange-600 mr-3"></i>
          Git情報
        </h2>
        <div class="space-y-4">
          <div>
            <p class="info-label mb-2">リモートURL</p>
            <p class="info-value text-base font-mono" id="git-remote">-</p>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <p class="info-label mb-2">ブランチ</p>
              <p class="info-value">
                <span class="badge badge-green" id="git-branch">-</span>
              </p>
            </div>
            <div>
              <p class="info-label mb-2">コミット</p>
              <p class="info-value font-mono" id="git-commit">-</p>
            </div>
          </div>
        </div>
      </div>

      <!-- システム情報 -->
      <div class="info-card rounded-xl p-6">
        <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
          <i class="fas fa-server text-green-600 mr-3"></i>
          システム情報
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <p class="info-label mb-2">Pythonバージョン</p>
            <p class="info-value" id="python-version">-</p>
          </div>
          <div>
            <p class="info-label mb-2">フレームワーク</p>
            <p class="info-value">FastAPI</p>
          </div>
        </div>
      </div>

    </div>

    <!-- エラー表示 -->
    <div id="error-message" class="hidden">
      <div class="bg-red-50 border border-red-200 rounded-xl p-6 text-center">
        <i class="fas fa-exclamation-circle text-4xl text-red-500 mb-4"></i>
        <p class="text-red-700 font-semibold">情報の取得に失敗しました</p>
        <p class="text-red-600 text-sm mt-2">ページを再読み込みしてください</p>
      </div>
    </div>

  </div>
</div>

<script>
  // ページ読み込み時に情報を取得
  async function loadRepositoryInfo() {
    try {
      const response = await fetch('/api/repository/info');
      
      if (!response.ok) {
        throw new Error('Failed to fetch repository info');
      }

      const data = await response.json();

      // 基本情報
      document.getElementById('repo-name').textContent = data.name || '-';
      document.getElementById('repo-version').textContent = data.version || '-';
      document.getElementById('repo-description').textContent = data.description || '-';

      // Git情報
      document.getElementById('git-remote').textContent = data.git_remote || 'N/A';
      document.getElementById('git-branch').textContent = data.git_branch || 'N/A';
      document.getElementById('git-commit').textContent = data.git_commit || 'N/A';

      // システム情報
      document.getElementById('python-version').textContent = data.python_version || '-';

      // ローディングを非表示、情報を表示
      document.getElementById('loading').classList.add('hidden');
      document.getElementById('info-container').classList.remove('hidden');

    } catch (error) {
      console.error('Error loading repository info:', error);
      
      // ローディングを非表示、エラーを表示
      document.getElementById('loading').classList.add('hidden');
      document.getElementById('error-message').classList.remove('hidden');
    }
  }

  // ページ読み込み時に実行
  document.addEventListener('DOMContentLoaded', loadRepositoryInfo);
</script>
{% endblock %}
